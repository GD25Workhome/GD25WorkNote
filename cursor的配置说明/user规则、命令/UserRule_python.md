# User Rule：Python 环境与依赖管理

## 规则内容

### Python 环境管理原则

```
环境检查原则：
- 执行任何 Python 相关命令前，必须首先检查当前 conda 环境
- 必须确认环境是否正确，使用完整路径或显式激活环境
- 必须验证 Python 版本符合项目要求
- 必须检查相关包是否已安装
- 可以使用命令："检查 Conda 环境" 或 "验证环境一致性" 来执行检查（需要用户手动调用或在对话中明确要求）

环境使用规范：
- ✅ 正确：使用完整路径 /path/to/envs/env_name/bin/python
- ✅ 正确：使用完整路径 /path/to/envs/env_name/bin/pip
- ❌ 错误：直接使用 python 或 pip（可能指向系统 Python）

错误处理原则：
- 遇到错误时，首先检查 conda 环境（最常见的错误原因）
- 查看完整的错误信息，不要只看最后几行
- 分析根本原因，而不是表面现象
- 提供具体的解决方案，而不是泛泛的建议

常见错误类型：
- ImportError：检查 conda 环境和包安装
- 版本冲突：检查 requirements.txt 中的版本约束
- 找不到模块：检查 Python 路径和环境
```

### 依赖管理原则

```
requirements.txt 管理原则：
- 保持版本范围约束（如 >=0.3.0,<1.0.0），避免过于严格的版本锁定
- 注意版本兼容性说明，特别是跨大版本的依赖关系
- 使用 requirements.lock 用于生产环境部署

依赖安装原则：
- 安装依赖时必须在正确的 conda 环境中执行
- 安装后必须验证：pip check 检查版本冲突
- 如果出现版本冲突，分析根本原因并调整版本约束
- 可以使用命令："安装依赖并检查冲突" 或 "安装依赖并自动更新 Lock" 来执行安装（需要用户手动调用或在对话中明确要求）

依赖锁定原则：
- 执行包管理相关命令（pip install/update/uninstall）后，必须更新 requirements.lock
- 确保 lock 文件包含所有直接和间接依赖的精确版本
- 检查 requirements.txt 和 requirements.lock 的一致性
- 如有冲突，更新 requirements.txt 的版本约束或说明原因
- 可以使用命令："更新依赖锁定文件" 来执行更新（需要用户手动调用或在对话中明确要求）
```

## 使用说明

此规则定义了 Python 开发环境管理和依赖管理的所有原则和规范。

**适用场景**：
- 执行任何 Python 相关命令前
- 安装或更新 Python 依赖时
- 遇到 Python 相关错误时
- 管理项目依赖时

**配合使用**：
- 配合 `UserCommands_python.md` 中的命令使用
- 规则定义原则，命令执行操作

**重要说明**：
- ⚠️ Cursor 不会自动将规则和命令关联，需要用户手动调用命令
- 规则会指导 AI 的行为，但不会自动执行 User Commands 中的命令
- 用户可以通过以下方式使用命令：
  1. 在 Cursor 命令面板中手动选择命令
  2. 在对话中明确要求 AI 执行某个操作（AI 会根据规则执行，但可能不是调用 User Commands）
  3. 在规则中已说明可以使用哪些命令，用户需要时手动调用

